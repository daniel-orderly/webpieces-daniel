#{extends '../backend/main.html'/}#
#{set title:'Webpieces QuickStart'/}#
#{set tab:'management'/}#

<ol>
    <li><a href="@[QUICK_START]@">&{ 'Basic Hello World', 'helloworld'}&</a>
    <li><a href="@[QUICK_START2]@">&{ 'Dynamic Hello World', 'dynamichelloworld'}&</a>
    <li><a href="@[QUICK_START3]@">&{ 'Persistent Hello World', 'persistenthelloworld'}&</a>
    <li><a href="@[QUICK_START3]@">&{ 'CRUD no ajax', 'crudNoAjax'}&</a>
    <li><a href="@[QUICK_START4]@">&{ 'ajax CRUD', 'ajaxCrud'}&</a>
    <li><a href="@[QUICK_START5]@">&{ 'Login', 'ajaxCrud'}&</a>
    <li><a href="@[QUICK_START6]@">&{ 'Helloworld Test', 'helloworldTest'}&</a>
    <li><a href="@[QUICK_START7]@">&{ 'Helloworld Tag', 'helloworldTag'}&</a>
</ol>

<h2>Your first Hibernate entity</h2>

<p>Ideally however in a dynamic web application, we would like to let people persist data for a later time and
modify that data.  A Hibernate plugin is installed by default for rapid prototyping though you can remove the
hibernate plugin from the build files if you desire and use something else.  In the meantime, welcome to
our first hibernate entity bean</p>

<pre>
<code>package org.webpieces.helloworld.myapp;

import java.util.List;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.EntityManager;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.NamedQueries;
import javax.persistence.NamedQuery;
import javax.persistence.Query;
import javax.persistence.SequenceGenerator;
import javax.persistence.Table;

//NOTE: More can be found in the hibernate documenation
//This tells hibernate this is an entity bean and will be stored
@Entity
//@Table informs hibernate of more details on the table such as name
@Table(name="CAR")
//@NamedQueries is where we define queries we will make into the database
@NamedQueries({
	//For more info on the query language, see the hibernate HQL (Hibernate Query Language)
	//for details
	@NamedQuery(name = "findAllCars", query = "select u from CarDbo as u"),
})
public class CarDbo {

	//@Id tell hibernate this is the primary key
	@Id
	//This annotation says grab 10 ids at a time in memory on this host so we don't hit the database on every create row to
	//populate the id.  The name needs to match the generator below.  It is good idea to always rename these so be
	//careful of cut/paste
	@SequenceGenerator(name="car_id_gen",sequenceName="car_sequence" ,initialValue=1,allocationSize=10)
	//This tells hibernate to just generate the ids in sequence
	@GeneratedValue(strategy=GenerationType.SEQUENCE,generator="car_id_gen")
	private Integer id; //You almost always want to use Integer over int and Long over long so it can be null so you can tell if it has been persisted

	private String name;

	//Use @Column to further define the column like forcing it to be unique
	@Column(unique = true)
	private String style;

	public Integer getId() {
		return id;
	}

	public void setId(Integer id) {
		this.id = id;
	}

	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}

	public String getStyle() {
		return style;
	}

	public void setStyle(String style) {
		this.style = style;
	}

    //This method re-uses the @NamedQuery we defined above
	@SuppressWarnings("unchecked")
	public static List&lt;CarDbo&gt; findAll(EntityManager mgr) {
		Query query = mgr.createNamedQuery("findAllCars");
		return query.getResultList();
	}
}
</code>
</pre>

<p>This is where we will put all the RouteIds for this package and for this RouteModule.  Notice that the enum must extend
RouteId as webpieces only knows about RouteId and not your specific enum.  Next, let's use the RouteId and create a
RouteModule called MyMainRoutes with a single route to our new webpage</p>

<pre>
<code>package org.webpieces.helloworld.myapp;

import org.webpieces.ctx.api.HttpMethod;
import org.webpieces.router.api.routing.AbstractRoutes;

public class MyMainRoutes extends AbstractRoutes {
    @Override
    protected void configure() {
        addRoute(HttpMethod.GET ,   "/helloworld",        "MyMainController.helloWorld", MyMainRouteId.HELLO_WORLD);
    }
}</code>
</pre>

<p>Here, we are saying when the browser calls any of these urls that end up on our server, webpieces will invoke
MyMainController.helloWorld</p>

<ol>
    <li>http://localhost:8080/helloworld</li>
    <li>https://localhost:8080/helloworld</li>
    <li>http://anydomain.com/helloworld  #As long as your DNS is setup properly and we receive the request</li>
</ol>

<p>Basically, domains are ignored by default though you can match on domain(see the Routes Reference for more info).
Now that we defined a route and a Controller and method to invoke, we should create the Controller</p>

<pre>
<code>package org.webpieces.helloworld.myapp;

import javax.inject.Singleton;
import org.webpieces.router.api.actions.Action;
import org.webpieces.router.api.actions.Actions;

@Singleton
public class MyMainController {
    public Action helloWorld() {
        return Actions.renderThis();
    }
}</code>
</pre>

<p>Lastly, Actions.renderThis() informs webpieces to render the html file with the same name as the method helloWorld so
next create a file called helloWorld.html in the same directory as the Controller</p>

<pre>
<code>&lt;html&gt;
    &lt;head&gt;&lt;/head&gt;
    &lt;body&gt;
        Hello World
    &lt;/body&gt;
&lt;/html&gt;</code>
</pre>

<p>Finally, the one last step is we need to tell webpieces about this RouteModule that we created.  Inside the class
MyHelloWorldMeta.java, modify it to add the RouteModule to the list of RouteModules already defined.  Your new
getRouteModules method should look like so</p>

<pre>
<code>@Override
public List&lt;Routes&gt; getRouteModules() {
    return Lists.newArrayList(
    new AppRoutes(),
    new LoginRoutes("/org/webpieces/helloworld/base/crud/login/AppLoginController", "/secure/.*"),
    new CrudRoutes(),
    new AjaxCrudRoutes(),
    new JsonRoutes(),
    new MyMainRoutes()
    );
}</code>
</pre>

<p>A big note is that all the modules here should be deleted except for LoginRoutes in your production application as
they are all examples.  While LoginRoutes is an example as well, you most likely want a way to login so you would keep
the LoginRoutes module</p>

<p>Finally, boot up your DevelopmentServer.java main class and open a browser and go to http://localhost:8080/helloworld
or go to https://localhost:8443/helloworld</p>

<p>Congratulations on your first webpieces page, next we will make our html a bit more dynamic</p>

<a class="btn btn-primary" href="@[QUICK_START4]@" role="button">Next Basic CRUD</a>
