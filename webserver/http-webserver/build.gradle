apply plugin: 'jacoco' //code coverage

sourceSets {
    test {
        resources {
            //This ADDS src/main/java/**/*.html and we still read in src/test/resources/**
            srcDirs = ["src/test/java", "src/test/resources"]
            excludes = ["**/*.java"]
        }
    }
}

dependencies {
    compile deps['guice']
    compile project(':http:http-frontend'), project(':http:http1_1-parser')
    compile project(':webserver:http-templating'), project(':webserver:http-router')

    testCompile project(':webserver:http-webserver-test')
    testCompile project(':webserver:http-router-dev')
    testCompile deps['selenium']
}

uploadArchives.repositories.mavenDeployer.pom.project {
   description='The full webpieces server AS A library'
}

test {
    if (project.hasProperty('excludeSelenium')) {
        exclude '**/*Selenium*'
    }
}

jacocoTestReport {
    additionalSourceDirs = 
       files(
          project(":core:core-asyncserver").sourceSets.main.java.srcDirs +
          project(":core:core-channelmanager2").sourceSets.main.java.srcDirs +
          project(":core:core-datawrapper").sourceSets.main.java.srcDirs +
          project(":core:core-mock").sourceSets.main.java.srcDirs +
          project(":core:core-ssl").sourceSets.main.java.srcDirs +
          project(":core:core-util").sourceSets.main.java.srcDirs +
          project(":core:runtimecompile").sourceSets.main.java.srcDirs +
          project(":http:http-frontend").sourceSets.main.java.srcDirs +
          project(":http:http1_1-parser").sourceSets.main.java.srcDirs +
          project(":http:http2-parser").sourceSets.main.java.srcDirs +
          project(":webserver:http-router").sourceSets.main.java.srcDirs +
          project(":webserver:http-router-dev").sourceSets.main.java.srcDirs +
          project(":webserver:http-shared").sourceSets.main.java.srcDirs +
          project(":webserver:http-templating").sourceSets.main.java.srcDirs +
          project(":webserver:http-templating-dev").sourceSets.main.java.srcDirs +
          project(":webserver:http-webserver").sourceSets.main.java.srcDirs
       )

    println("files="+additionalSourceDirs.files)
    reports {
         xml.enabled = true
         html.enabled = true
    }
}

jacocoTestReport.dependsOn test
check.dependsOn jacocoTestReport

