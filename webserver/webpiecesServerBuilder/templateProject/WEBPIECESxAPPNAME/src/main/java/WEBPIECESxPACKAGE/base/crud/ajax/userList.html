#{extends '../../userTemplate.html' /}#
#{set subtab:'userlist'/}#

<h4>Users</h4>

<div id="addEditPatternModal" class="modal hide #{if showPopup}#in#{/if}#" tabindex="-1" 
     role="dialog" data-backdrop="true" aria-labelledby="addEditModalLabel" 
     aria-hidden="#{if showPopup}#false#{/if}##{else}#true#{/else}#"
    #{if showPopup}#style="display: block;"#{/if}#>
    #{if showPopup}#
        #{renderPageArgs 'userAddEdit.html'/}#
        <script type="text/javascript">
           $(document).ready(function() { 
               $("#addEditPatternModal").modal('show');   
           });
        </script>
    #{/if}#
</div>
<div id="deletePatternModal"></div>
<table class="table">
    <thead>
        <tr>
            <th>FirstName</th>
            <th>LastName</th>
            <th>Email</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        #{list items:users, as:'entity'}#
            <tr>
                <td>${entity.firstName}$</td>
                <td>${entity.lastName}$</td>
                <td>${entity.email}$</td>
                <td>
                        <a href="#" data-toggle="modal" class="btn" id="editLink_${entity_index-1}$">
                            Edit
                        </a>
                        <script type="text/javascript">
                        *{
                            var getAddEditPattern= function(options) {
                            	var pattern = '/ourpattern/ajaxAddEdit/:id';
                            	for(key in options) {
                            		var val = options[key];
                            		var nextVal = ( (val===undefined || val===null) ? '' : val)
                            		pattern = pattern.replace(':' + encodeURIComponent(key), nextVal);
                            	}
                            	return pattern;
                            }
                             $(document).ready(function() {	
                                 $("#editLink_0").click(function(e){
                                     $('#addEditPatternModal').load(getAddEditPattern({id:500}),function(){
                                         $("#addEditPatternModal").modal('show');	
                                      });
                                 });
                       	    });
                        }*
                            var getAddEditPattern= #{jsAction @[AJAX_EDIT_USER_FORM, id:':id:']@ /}#
                             $(document).ready(function() {	
                                 $("#editLink_${entity_index-1}$").click(function(e){
                                     $('#addEditPatternModal').load(getAddEditPattern({id:${entity.id}$}),function(){
                                         $("#addEditPatternModal").modal('show');	
                                      });
                                 });
                       	    });
                        </script>
                        <a href="#" data-toggle="modal" class="btn" id="deletePattern_${entity_index-1}$"> Delete </a>
                        <script type="text/javascript">
                        *{

						    var getDeletePattern= function(options) {
						    	var pattern = '/ourpattern/ajaxDelete/{id}';
						    	for(key in options) {
						    		var val = options[key];
						    		var nextVal = (val===undefined || val===null) ? '' : val
						    		pattern = pattern.replace('{'+key+'}', nextVal);
						    	}
						    	return pattern;
						    }
						    $(document).ready(function() {	
						        $("#deletePattern_0").click(function(e){
						            $('#deletePatternModal').load(getDeletePattern({id:'500'}),function(){
						                 $("#myDeletePattern").modal('show');	
						            });
						        });
						  	});
                   
                        }*
							    var getDeletePattern= #{jsAction @[AJAX_CONFIRM_DELETE_USER, id:'{id}']@ /}#
							    $(document).ready(function() {	
							        $("#deletePattern_${entity_index-1}$").click(function(e){
							            $('#deletePatternModal').load(getDeletePattern({id:'${entity.id}$'}),function(){
							                 $("#myDeletePattern").modal('show');	
							            });
							        });
							  	});
                       </script>
                   </td>
            </tr>
        #{/list}#
        #{else}#
        <tr>
            <td colspan="4">
            There are no users, Add one now please.
            </td>
        </tr>
        #{/else}#
    </tbody>
</table>

<a href="#" class="btn btn-primary" id="addLink">Add User</a>
<script type="text/javascript">
*{
	var getAddEditPattern= function(options) {
		var pattern = '/ourpattern/ajaxAddEdit/:id';
		for(key in options) {
			var val = options[key];
			var nextVal = (val===undefined || val===null) ? '' : val
			pattern = pattern.replace(':' + encodeURIComponent(key), nextVal);
		}
		return pattern;
	}
	$(document).ready(function() {	
	     $("#addLink").click(function(e){
	         $('#addEditPatternModal').load(getAddEditPattern(),function(){
	              $("#addEditPatternModal").modal('show');	
	         });
	     });
	});
}*

var getAddEditPattern= #{jsAction @[AJAX_ADD_USER_FORM]@ /}#
$(document).ready(function() {	
     $("#addLink").click(function(e){
         $('#addEditPatternModal').load(getAddEditPattern(),function(){
              $("#addEditPatternModal").modal('show');	
         });
     });
});
</script>
