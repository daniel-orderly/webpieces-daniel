#{extends '../../main.html'/}#
#{set title:'Ajax User List'/}#
#{set tab:'userlist'/}#

<h4>Users</h4>

*{ any changes to this modal 'if showPopup' would need to be retested in ALL browsers!!! }*
<div id="addEditModal" class="modal hide #{if showPopup}#in#{/if}#" tabindex="-1" 
     role="dialog" data-backdrop="true" aria-labelledby="addEditModalLabel" 
     aria-hidden="#{if showPopup}#false#{/if}##{else}#true#{/else}#">
     
     *{ Special case so if we POST and flash what the user typed in, when listing the entities
        we re-popup the dialogue with errors in it.  Better yet, our flash data now survives 
        login redirects as well and logging in so user doesn't lose what he typed out!!! }*
        
    #{if showPopup}#
        <script type="text/javascript">
        var getEditRoute= #{jsAction @[AJAX_EDIT_USER_FORM, id:'{id}']@ /}#
        var getAddRoute= #{jsAction @[AJAX_ADD_USER_FORM]@ /}#
        $(document).ready(function(){
	        #{if _flash.get('entity.id')}#
	            $('#addEditModal').load(getEditRoute({id:${_flash.get('entity.id')}$}),function(){
	                $("#addEditModal").modal('show');    
	            });
	        #{/if}#
	        #{else}#
		         $('#addEditModal').load(getAddRoute(),function(){
		              $("#addEditModal").modal('show'); 
		         });	        
	        #{/else}#
        });
        </script>
    #{/if}#
</div>
<div id="deleteModal" class="modal hide" data-backdrop="true" tabindex="-1" 
     role="dialog" data-backdrop="false" aria-labelledby="deleteModalLabel" aria-hidden="true">
</div>

<table class="table">
    <thead>
        <tr>
            <th>FirstName</th>
            <th>LastName</th>
            <th>Email</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        #{list items:users, as:'entity'}#
            <tr>
                <td>${entity.firstName}$</td>
                <td>${entity.lastName}$</td>
                <td>${entity.email}$</td>
                <td>
                   <a href="#" data-toggle="modal" class="btn" id="editLink_${entity.id}$">Edit</a>
                   #{bootstrapModal route:@[AJAX_EDIT_USER_FORM, id:'{id}']@, modalId:'addEditModal', linkId:'editLink_'+entity.id, id:entity.id/}#
                        
                   <a href="#" data-toggle="modal" class="btn" id="deletePattern_${entity.id}$"> Delete </a>
                   #{bootstrapModal route:@[AJAX_CONFIRM_DELETE_USER, id:'{id}']@, modalId:'deleteModal', linkId:'deletePattern_'+entity.id, id:entity.id/}#
                </td>
            </tr>
        #{/list}#
        #{else}#
        <tr>
            <td colspan="4">
            There are no users, Add one now please.
            </td>
        </tr>
        #{/else}#
    </tbody>
</table>

<a href="#" class="btn btn-primary" id="addLink">Add User</a>
#{bootstrapModal route:@[AJAX_ADD_USER_FORM]@, linkId:'addLink', modalId:'addEditModal'/}#








*{  This is one very long comment
 
THE ONE LINE bootstrapModal tag for the EDIT button replaces ALL the following code...

  <script type="text/javascript">
      var getEditRoute= #{jsAction @[AJAX_EDIT_USER_FORM, id:'{id}']@ /}#
       $(document).ready(function() {	
           $("#editLink_${entity.id}$").click(function(e){
               $('#addEditModal').load(getEditRoute({id:${entity.id}$}),function(){
                   $("#addEditModal").modal('show');	
                });
           });
 	    });
  </script>

                      
ABOVE ADD BUTTON IS THE SAME AS THIS.....

<script type="text/javascript">
var getAddRoute= #{jsAction @[AJAX_ADD_USER_FORM]@ /}#
$(document).ready(function() {	
     $("#addLink").click(function(e){
         $('#addEditModal').load(getAddRoute(),function(){
              $("#addEditModal").modal('show');	
         });
     });
});
</script>

For completeness, this is the DELETE button....

<script type="text/javascript">
 var getConfirmDeleteRoute = #{jsAction @[AJAX_CONFIRM_DELETE_USER, id:'{id}']@ /}#
 $(document).ready(function() {	
     $("#deletePattern_${entity.id}$").click(function(e){
         $('#deleteDiv').load(getConfirmDeleteRoute({id:'${entity.id}$'}),function(){
              $("#deleteModal").modal('show');	
         });
     });
});
</script>
                       
}*
