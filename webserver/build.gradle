project.ext {
  stagingDirName = 'projecttemplates'
  outputStagingDir = new File(buildDir, stagingDirName)
}

project('projecttemplates:templateProject:TEMPLATEAPPNAME-prod') {
    dependencies {
        compile project(':webserver:webserver')
    }
}

project('projecttemplates:templateProject:TEMPLATEAPPNAME-dev') {
    dependencies {
        compile project(':webserver:webserver')
        compile project(':webserver:http-router-dev')
        compile project(':webserver:http-templating-dev')
        compile project(':webserver:projecttemplates:templateProject:TEMPLATEAPPNAME-prod')
    }
}

task stageTemplate(type: Copy) {
    from '.'
    into buildDir
    include stagingDirName + '/**'
    exclude stagingDirName + '/output'
    exclude stagingDirName + '/.classpath'
    exclude stagingDirName + '/.project'
    exclude stagingDirName + '/.settings'
    exclude stagingDirName + '/templateProject/.classpath'
    exclude stagingDirName + '/templateProject/.project'
    exclude stagingDirName + '/templateProject/.settings'
    exclude stagingDirName + '/templateProject/output'
    exclude stagingDirName + '/templateProject/TEMPLATEAPPNAME-prod/output'
    exclude stagingDirName + '/templateProject/TEMPLATEAPPNAME-prod/bin'
    exclude stagingDirName + '/templateProject/TEMPLATEAPPNAME-prod/.classpath'
    exclude stagingDirName + '/templateProject/TEMPLATEAPPNAME-prod/.project'
    exclude stagingDirName + '/templateProject/TEMPLATEAPPNAME-prod/.settings'
    exclude stagingDirName + '/templateProject/TEMPLATEAPPNAME-dev/output'
    exclude stagingDirName + '/templateProject/TEMPLATEAPPNAME-dev/bin'
    exclude stagingDirName + '/templateProject/TEMPLATEAPPNAME-dev/.classpath'
    exclude stagingDirName + '/templateProject/TEMPLATEAPPNAME-dev/.project'
    exclude stagingDirName + '/templateProject/TEMPLATEAPPNAME-dev/.settings'
}

task stageProjectCreator(type: Sync, dependsOn: ['projectcreator:assemble', 'stageTemplate']) {
    from childProjects['projectcreator'].toStagingDir
    into new File(outputStagingDir, 'lib-creation')
}

assemble.dependsOn(['stageProjectCreator'])
